<div metal:use-macro="_LAYOUT">
<div metal:fill-slot="content">

  <script>
    $(function() {
        $(".dialog").dialog({autoOpen: false, width: 400});
        $("#testable_tab").tabs();
        $(".delete").on("click", function(event) {
            var name = event.target.getAttribute("data-name");
            var url = event.target.getAttribute("data-url");
            if (confirm("Are you sure you want to delete " + name + "?")) {
                $.ajax({url: url, type: "delete", complete: handle_response});
            }
        });
        $(".toggle_tc_file").on("change", function(event) {
            var testable = event.target.getAttribute("data-testable");
            var tc = event.target.getAttribute("data-tc");
            var div = $("#testable_" + testable + "_" + tc + "_file_div");
            var input = $("#testable_" + testable + "_tc_output_filename_" + tc);
            if (event.target.value == "file") {
                div.show();
                input.removeAttr("disabled");
            }
            else {
                div.hide();
                input.attr("disabled", "disabled");
            }
        });
        $(".toggle_tc_expected").on("change", function(event) {
            var testable = event.target.getAttribute("data-testable");
            var tc = event.target.getAttribute("data-tc");
            var div = $("#testable_" + testable + "_" + tc + "_expected_div");
            var hidden = $("#testable_" + testable + "_tc_expected_id_" + tc);
            var input = $("#testable_" + testable + "_tc_expected_" + tc);
            if (event.target.value == "diff") {
                div.show();
                hidden.removeAttr("disabled");
                input.removeAttr("disabled");
            }
            else {
                div.hide();
                hidden.attr("disabled", "disabled");
                input.attr("disabled", "disabled");
            }
        });
        $(".requeue").on("click", function(event) {
            if (confirm("Are you sure you want to requeue all the latest submissions?")) {
                $.ajax({url: window.location.href, type: 'put', complete: handle_response});
            }
        });
    });
  </script>

  <div class="header">${page_title}</div>

  <h3 tal:condition="project.class_.is_locked">The class for this project is
    locked. You will not be able to make any changes.</h3>

  <h3 tal:condition="project.status == 'locked'">This project is
    locked. You will not be able to make any changes.</h3>

  <fieldset tal:condition="flash">
    <legend>Status Messages</legend>
    <p tal:repeat="msg flash">${msg}</p>
  </fieldset>

  <p>
    <a href="${_R('class_item', class_name=project.class_.name)}">${project.class_.name}</a>
    --
    <a href="${_R('project_item_summary', class_name=project.class_.name, project_id=project.id)}">${project.name}</a>
  </p>

  <input type="button" value="requeue latest submissions" class="requeue" />

  <form id="project_form" name="input" action="${action}"
        onsubmit="return form_request(this, 'POST', true);">
    <fieldset>
      <legend>Basic Settings</legend>
      <label for="name">Name</label>
      <br/>
      <input type="text" name="name" id="name" value="${project.name}" />
      <br/>
      <label for="group_max">Maximum Group Size</label>
      <br/>
      <input type="text" name="group_max" id="group_max" value="${project.group_max}" />
      <br/>
      <label for="delay_minutes">Submission Results Delay (in minutes)</label>
      <br/>
      <input type="text" name="delay_minutes" id="delay_minutes" value="${project.delay_minutes}" />
      <br/>
      <label for="is_ready_new">Ready for Submission</label>
      <input type="checkbox" name="is_ready" id="is_ready_new" value="1" tal:attributes="checked 'checked' if project.is_ready else None"/>
      <br/>
      <div tal:condition="project.makefile">
        <a href="${_R('file_item', sha1sum=project.makefile.sha1, filename='Makefile')}">Existing Makefile</a></div>
      <label for="makefile">Select a Makefile: </label>
      <input name="makefile_id" id="makefile" type="file" />
      <input type="hidden" name="makefile_id" value="${project.makefile_id}" />
      <br/>
      <input type="submit" name="submit" value="Update" />
    </fieldset>
  </form>

  <h3><span class="help" title="A testable defines the parameters for a single executable that is produced from the student's submission.">Testables</span></h3>
  <div id="testable_tab">
    <ul>
      <li tal:repeat="testable sorted(project.testables)">
        <a href="#testable_tab_${testable.id}">${testable.name}</a>
      </li>
      <li style="background: #ccf; font-weight: bold"><a href="#testable_tab_new">New</a></li>
    </ul>

    <div tal:repeat="testable project.testables" id="testable_tab_${testable.id}">
      <form name="testable" action="${_R('testable_item', testable_id=testable.id)}"
            onsubmit="return form_request(this, 'POST', true);">
        <fieldset>
          <legend>Testable Settings</legend>
          <fieldset>
            <legend>Select <span class="help" title="Build files are static files that are required to make the executable. Build files can be shadowed by students' files by creating optional expected files.">Build Files</span></legend>
            <div tal:repeat="bf sorted(project.build_files)">
              <input type="checkbox" name="build_file_ids[]"
                     id="testable_bf_${testable.id}_${bf.id}"
                     value="${bf.id}" tal:attributes="checked 'checked' if bf in testable.build_files else None" />
              <label for="testable_bf_${testable.id}_${bf.id}">${bf.filename}</label>
              (<a href="${_R('file_item', sha1sum=bf.file.sha1, filename=bf.filename)}">view</a>)
              (<span data-name="${bf.filename}" data-url="${_R('build_file_item', build_file_id=bf.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#build_file_new').dialog('open');">new build file</span>
          </fieldset>

          <fieldset>
            <legend>Select <span class="help" title="Execution files are static files that are present in the directory during execution.">Execution Files</span></legend>
            <div tal:repeat="ef sorted(project.execution_files)">
              <input type="checkbox" name="execution_file_ids[]"
                     id="testable_ef_${testable.id}_${ef.filename}"
                     value="${ef.id}" tal:attributes="checked 'checked' if ef in testable.execution_files else None" />
              <label for="testable_ef_${testable.id}_${ef.filename}">${ef.filename}</label>
              (<a href="${_R('file_item', sha1sum=ef.file.sha1, filename=ef.filename)}">view</a>)
              (<span data-name="${ef.filename}" data-url="${_R('execution_file_item', execution_file_id=ef.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#execution_file_new').dialog('open');">new execution file</span>
          </fieldset>

          <fieldset>
            <legend>Select <span class="help" title="Expected files are those that students submit with their projects.">Expected Files</span></legend>
            <div tal:repeat="fv sorted(project.file_verifiers)">
              <input type="checkbox" name="file_verifier_ids[]"
                     id="testable_fv_${testable.id}_${fv.id}"
                     value="${fv.id}" tal:attributes="checked 'checked' if fv in testable.file_verifiers else None" />
              <label for="testable_fv_${testable.id}_${fv.id}">${fv.filename} <span tal:condition="fv.optional">[optional]</span></label>
              (<span class="faulink" onclick="$('#file_verifier_${fv.id}').dialog('open');">edit</span>)
              (<span data-name="${fv.filename}" data-url="${_R('file_verifier_item', file_verifier_id=fv.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#file_verifier_new').dialog('open');">define new expected file</span>
          </fieldset>
          <input type="hidden" name="project_id" value="${project.id}" />
          <label for="testable_name_${testable.id}">Name</label>
          <input type="text" name="name" id="testable_name_${testable.id}"
                 value="${testable.name}" />
          <br/>
          <div tal:condition="project.makefile_id">
            <label for="make_target_${testable.id}">Make target</label>
            <input type="text" name="make_target" id="make_target_${testable.id}"
                   value="${testable.make_target}" placeholder="don't run make" />
          </div>
          <label for="executable_${testable.id}">Executable</label>
          <input type="text" name="executable" id="executable_${testable.id}"
                 value="${testable.executable}" />
          <br/>
          <input type="submit" name="submit" value="update" />
          <input type="button" value="delete" class="delete" data-name="${testable.name}" data-url="${_R('testable_item', testable_id=testable.id)}" />
        </fieldset>
      </form>

      <fieldset>
        <legend>Test Cases</legend>
        <ul>
          <li tal:repeat="tc sorted(testable.test_cases)">
            <span class="faulink" onclick="$('#update_tc_${tc.id}').dialog('open');">${tc.name}</span>
          </li>
          <li>(<span class="faulink" onclick="$('#testable_${testable.id}_tc_new').dialog('open');">add new test case</span>)</li>
        </ul>
      </fieldset>
    </div>

    <div id="testable_tab_new" style="background: #ccf">
      <form name="testable" action="${_R('testable')}"
            onsubmit="return form_request(this, 'PUT', true);">
        <fieldset>
          <legend>Testable Settings</legend>
          <fieldset>
            <legend>Select <span class="help" title="Build files are static files that are required to make the executable. Build files can be shadowed by students' files by creating optional expected files.">Build Files</span></legend>
            <div tal:repeat="bf sorted(project.build_files)">
              <input type="checkbox" name="build_file_ids[]"
                     id="testable_bf_new_${bf.id}"
                     value="${bf.id}" />
              <label for="testable_bf_new_${bf.id}">${bf.filename}</label>
              (<span data-name="${bf.filename}" data-url="${_R('build_file_item', build_file_id=bf.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#build_file_new').dialog('open');">new build file</span>
          </fieldset>
          <fieldset>
            <legend>Select <span class="help" title="Execution files are static files that are present in the directory during execution.">Execution Files</span></legend>
            <div tal:repeat="ef sorted(project.execution_files)">
              <input type="checkbox" name="execution_file_ids[]"
                     id="testable_ef_new_${ef.filename}"
                     value="${ef.id}" />
              <label for="testable_ef_new_${ef.filename}">${ef.filename}</label>
              (<span data-name="${ef.filename}" data-url="${_R('execution_file_item', execution_file_id=ef.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#execution_file_new').dialog('open');">new execution file</span>
          </fieldset>

          <fieldset>
            <legend>Select <span class="help" title="Expected files are those that students submit with their projects.">Expected Files</span></legend>
            <div tal:repeat="fv sorted(project.file_verifiers)">
              <input type="checkbox" name="file_verifier_ids[]"
                     id="testable_fv_new_${fv.id}"
                     value="${fv.id}" />
              <label for="testable_fv_new_${fv.id}">${fv.filename} <span tal:condition="fv.optional">[optional]</span></label>
              (<span class="faulink" onclick="$('#file_verifier_${fv.id}').dialog('open');">edit</span>)
              (<span data-name="${fv.filename}" data-url="${_R('file_verifier_item', file_verifier_id=fv.id)}" class="delete faulink">delete</span>)
            </div>
            <span class="faulink" onclick="$('#file_verifier_new').dialog('open');">define new expected file</span>
          </fieldset>
          <input type="hidden" name="project_id" value="${project.id}" />
	  <label for="testable_name_new">Name</label>
          <input type="text" name="name" id="testable_name_new" />
          <br/>
          <div tal:condition="project.makefile_id">
            <label for="make_target_new">Make target</label>
            <input type="text" name="make_target" id="make_target_new" placeholder="don't run make"/>
          </div>
          <label for="executable_new">Executable</label>
          <input type="text" name="executable" id="executable_new" />
	  <br/>
          <input type="submit" name="submit" value="add" />
        </fieldset>
      </form>
    </div>
  </div>

  <!-- Dialog Boxes -->
  <div id="build_file_new" class="dialog" title="Add New Build File" style="background: #ccf">
    <form name="build_file" action="${_R('build_file')}"
          onsubmit="return form_request(this, 'PUT', true);">
      <label for="build_filename_new">Filename</label>
      <input type="text" name="filename" id="build_filename_new" value="" />
      <label for="build_file_id_new">Select a build file: </label>
      <input name="file_id" id="build_file_id_new" type="file" />
      <br/>
      <input type="hidden" name="project_id" value="${project.id}" />
      <input type="submit" name="submit" value="add" />
    </form>
  </div>

  <div id="execution_file_new" class="dialog" title="Add New Execution File" style="background: #ccf">
    <form name="execution_file" action="${_R('execution_file')}"
          onsubmit="return form_request(this, 'PUT', true);">
      <label for="execution_filename_new">Filename</label>
      <input type="text" name="filename" id="execution_filename_new" value="" />
      <label for="execution_file_id_new">Select an execution file: </label>
      <input name="file_id" id="execution_file_id_new" type="file" />
      <br/>
      <input type="hidden" name="project_id" value="${project.id}" />
      <input type="submit" name="submit" value="add" />
    </form>
  </div>

  <div id="file_verifier_new" class="dialog" title="Add New Expected File" style="background: #ccf">
    <form name="file_verifier" action="${_R('file_verifier')}"
          onsubmit="return form_request(this, 'PUT', true);">
      <label for="fv_filename_new">Filename</label>
      <input type="text" name="filename" id="fv_filename_new" value="" />
      <br/>
      <label for="min_size_new">Min Size</label>
      <input type="text" name="min_size" id="min_size_new" value="0" />
      <br/>
      <label for="max_size_new">Max Size</label>
      <input type="text" name="max_size" id="max_size_new"
             class="form_optional" placeholder="system max" value="" />
      <br/>
      <label for="min_lines_new">Min Lines</label>
      <input type="text" name="min_lines" id="min_lines_new" value="0" />
      <br/>
      <label for="max_lines_new">Max Lines</label>
      <input type="text" name="max_lines" id="max_lines_new"
             class="form_optional" placeholder="system max" value="" />
      <br/>
      <label for="warning_regex_new"><span class="help" title="If provided, any lines which match the regular expression provided here will be output under warning of possible invalid content header.">Warning Regex</span></label>
      <input type="text" name="warning_regex" id="warning_regex_new"
             class="form_optional" placeholder="accept everything" value="" />
      <br/>
      <label for="copy_to_execution_new"><span class="help" title="When checked, the file will be available relative to the present working directory during test execution. This is useful if you want the students to submit input files or test-cases.">Copy to Execution Environment</span></label>
      <input type="checkbox" name="copy_to_execution" id="copy_to_execution_new" value="1" />
      <br/>
      <label for="optional_new">Optional</label>
      <input type="checkbox" name="optional" id="optional_new" value="1" />
      <input type="hidden" name="project_id" value="${project.id}" />
      <br/>
      <input type="submit" name="submit" value="add" />
    </form>
  </div>
  <div tal:repeat="fv project.file_verifiers" id="file_verifier_${fv.id}"
       class="dialog" title="Update Expected File ${fv.filename}">
    <fieldset>
      <legend>Expected File ${fv.filename}</legend>
      <form name="file_verifier" onsubmit="return form_request(this, 'POST', true);"
            action="${_R('file_verifier_item', file_verifier_id=fv.id)}">
        <label for="filename_${fv.id}">Filename</label>
        <input type="text" name="filename" id="filename_${fv.id}"
               value="${fv.filename}" />
        <br/>
        <label for="min_size_${fv.id}">Min Size</label>
        <input type="text" name="min_size" id="min_size_${fv.id}"
               value="${fv.min_size}" />
        <br/>
        <label for="max_size_${fv.id}">Max Size</label>
        <input type="text" name="max_size" id="max_size_${fv.id}"
               class="form_optional" placeholder="system max"
               value="${fv.max_size}" />
        <br/>
        <label for="min_lines_${fv.id}">Min Lines</label>
        <input type="text" name="min_lines" id="min_lines_${fv.id}"
               value="${fv.min_lines}" />
        <br/>
        <label for="max_lines_${fv.id}">Max Lines</label>
        <input type="text" name="max_lines" id="max_lines_${fv.id}"
               class="form_optional" placeholder="system max"
               value="${fv.max_lines}" />
        <br/>
        <label for="warning_regex_${fv.id}"><span class="help" title="If provided, any lines which match the regular expression provided here will be output under warning of possible invalid content header.">Warning Regex</span></label>
        <input type="text" name="warning_regex" id="warning_regex_${fv.id}"
               class="form_optional" placeholder="accept everything" value="${fv.warning_regex}" />
        <br/>
      <label for="copy_to_execution_${fv.id}"><span class="help" title="When checked, the file will be available relative to the present working directory during test execution. This is useful if you want the students to submit input files or test-cases.">Copy to Execution Environment</span></label>
      <input type="checkbox" name="copy_to_execution" id="copy_to_execution_${fv.id}" value="1" tal:attributes="checked 'checked' if fv.copy_to_execution else None"/>
      <br/>
        <label for="optional_${fv.id}">Optional</label>
        <input type="checkbox" name="optional" id="optional_${fv.id}"
               value="1" tal:attributes="checked 'checked' if fv.optional else None"/>
        <br/>
        <input type="submit" name="submit" value="update" />
      </form>
    </fieldset>
  </div>

  <div tal:repeat="testable project.testables">
    <div tal:repeat="tc testable.test_cases" class="dialog" id="update_tc_${tc.id}" title="Update test case ${tc.name}">
      <form name="test_case"
            action="${_R('test_case_item', test_case_id=tc.id)}"
            onsubmit="return form_request(this, 'POST', true);">
        <label for="testable_${testable.id}_tc_name_${tc.id}">Test Name</label>
        <input type="text" name="name" id="testable_${testable.id}_tc_name_${tc.id}" value="${tc.name}" />
        <br/>
        <label for="testable_${testable.id}_tc_args_${tc.id}">Execution line</label>
        <input type="text" name="args" id="testable_${testable.id}_tc_args_${tc.id}"
         value="${tc.args}" />
        <br/>
        <label for="testable_${testable.id}_tc_points_${tc.id}">Points</label>
        <input type="text" name="points" id="testable_${testable.id}_tc_points_${tc.id}"
               value="${tc.points}" />
        <br/>
        <div tal:condition="tc.stdin_id">
          <a href="${_R('file_item', sha1sum=tc.stdin.sha1, filename='{0}:{1}:stdin'.format(project.name, tc.name))}">Existing standard input file</a>
        </div>
        <label for="testable_${testable.id}_tc_input_${tc.id}">Select a new standard input file: </label>
        <input name="stdin_id" id="testable_${testable.id}_tc_input_${tc.id}" type="file" />
        <br/>
        <input type="hidden" name="stdin_id" value="${tc.stdin_id}" />
        Output file source:
        <div style="margin-left: 20px">
          <input id="testable_${testable.id}_tc_source_stdout_${tc.id}" name="output_source"
                 type="radio" value="stdout" class="toggle_tc_file"
                 tal:attributes="checked 'checked' if tc.source == 'stdout' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}" />
          <label for="testable_${testable.id}_tc_source_stdout_${tc.id}">STDOUT</label>
          <br/>
          <input id="testable_${testable.id}_tc_source_stderr_${tc.id}" name="output_source"
                 type="radio" value="stderr" class="toggle_tc_file"
                 tal:attributes="checked 'checked' if tc.source == 'stderr' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}" />
          <label for="testable_${testable.id}_tc_source_stderr_${tc.id}">STDERR</label>
          <br/>
          <input id="testable_${testable.id}_tc_source_file_${tc.id}" name="output_source"
                 type="radio" value="file" class="toggle_tc_file"
                 tal:attributes="checked 'checked' if tc.source == 'file' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}" />
          <label for="testable_${testable.id}_tc_source_file_${tc.id}">named file</label>
        </div>
        <div id="testable_${testable.id}_${tc.id}_file_div"
             tal:attributes="style 'display: None' if tc.source != 'file' else None">
          <label for="testable_${testable.id}_tc_output_filename_${tc.id}">Output file name</label>
          <input type="text" name="output_filename" value="${tc.output_filename}"
                 id="testable_${testable.id}_tc_output_filename_${tc.id}"
                 tal:attributes="disabled 'disabled' if tc.source != 'file' else None" />
        </div>
        Output file handling:
        <div style="margin-left: 20px">
          <input id="testable_${testable.id}_tc_type_diff_${tc.id}" name="output_type"
                 type="radio" value="diff" class="toggle_tc_expected"
                 tal:attributes="checked 'checked' if tc.output_type == 'diff' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}"/>
          <label for="testable_${testable.id}_tc_type_diff_${tc.id}">Diff</label>
          <br/>
          <input id="testable_${testable.id}_tc_type_text_${tc.id}" name="output_type"
                 type="radio" value="text"  class="toggle_tc_expected"
                 tal:attributes="checked 'checked' if tc.output_type == 'text' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}" />
          <label for="testable_${testable.id}_tc_type_text_${tc.id}">Save (text)</label>
          <br/>
          <input id="testable_${testable.id}_tc_type_image_${tc.id}" name="output_type"
                 type="radio" value="image"  class="toggle_tc_expected"
                 tal:attributes="checked 'checked' if tc.output_type == 'image' else None"
                 data-testable="${testable.id}" data-tc="${tc.id}" />
          <label for="testable_${testable.id}_tc_type_image_${tc.id}">Save (image)</label>
        </div>


        <fieldset id="testable_${testable.id}_${tc.id}_expected_div"
             tal:attributes="style 'display: None' if tc.output_type != 'diff' else None">
          <legend>Diff settings</legend>
          <div tal:condition="tc.expected_id">
            <a href="${_R('file_item', sha1sum=tc.expected.sha1, filename='{0}:{1}:expected'.format(project.name, tc.name))}">Existing expected output file</a>
          </div>
          <label for="testable_${testable.id}_tc_expected_${tc.id}">Select a new expected output file: </label>
          <input name="expected_id" id="testable_${testable.id}_tc_expected_${tc.id}" type="file"
                 tal:attributes="disabled 'disabled' if tc.output_type != 'diff' else None" />
          <br/>
          <input id="testable_${testable.id}_tc_expected_id_${tc.id}" type="hidden"
                 name="expected_id" value="${tc.expected_id}" />
          <input type="checkbox" name="hide_expected" id="testable_${testable.id}_tc_hide_expected_${tc.id}" value="1"
                 tal:attributes="checked 'checked' if tc.hide_expected else None" />
          <label for="testable_${testable.id}_tc_hide_expected_${tc.id}"><span class="help" title="This obscures the left-hand-side of the diff output in the student view thus preventing students from determining what their program should output.">Hide expected output</span></label>
        </fieldset>
        <br/>
        <input type="submit" name="submit" value="update" />
        <input type="button" value="delete" class="delete" data-name="${tc.name}" data-url="${_R('test_case_item', test_case_id=tc.id)}" />
      </form>
    </div>
    <div id="testable_${testable.id}_tc_new" class="dialog"
         title="Add new test case" style="background: #ccf">
      <form name="test_case" action="${_R('test_case')}"
            onsubmit="return form_request(this, 'PUT', true);">
        <label for="testable_${testable.id}_tc_name_new">Test Name</label>
        <input type="text" name="name" id="testable_${testable.id}_tc_name_new" />
        <br/>
        <label for="testable_${testable.id}_tc_args_new">Execution line</label>
        <input type="text" name="args" id="testable_${testable.id}_tc_args_new" value="a.out" />
        <br/>
        <label for="testable_${testable.id}_tc_points_new">Points</label>
        <input type="text" name="points" id="testable_${testable.id}_tc_points_new" value="1" />
        <br/>
        <label for="testable_${testable.id}_tc_input_new">Select a standard input file: </label>
        <input name="stdin_id" id="testable_${testable.id}_tc_input_new" type="file" />
        <br/>
        <input type="hidden" name="stdin_id" value="" />
        Output file source:
        <div style="margin-left: 20px">
          <input id="testable_${testable.id}_tc_source_stdout_new" name="output_source"
                 type="radio" value="stdout" class="toggle_tc_file" checked="checked"
                 data-testable="${testable.id}" data-tc="new" />
          <label for="testable_${testable.id}_tc_source_stdout_new">STDOUT</label>
          <br/>
          <input id="testable_${testable.id}_tc_source_stderr_new" name="output_source"
                 type="radio" value="stderr" class="toggle_tc_file"
                 data-testable="${testable.id}" data-tc="new" />
          <label for="testable_${testable.id}_tc_source_stderr_new">STDERR</label>
          <br/>
          <input id="testable_${testable.id}_tc_source_file_new" name="output_source"
                 type="radio" value="file" class="toggle_tc_file"
                 data-testable="${testable.id}" data-tc="new" />
          <label for="testable_${testable.id}_tc_source_file_new">named file</label>
        </div>
        <div id="testable_${testable.id}_new_file_div" style="display: None">
          <label for="testable_${testable.id}_tc_output_filename_new">Output file name</label>
          <input type="text" name="output_filename"
                 id="testable_${testable.id}_tc_output_filename_new" disabled="disabled" />
        </div>
        Output file handling:
        <div style="margin-left: 20px">
          <input id="testable_${testable.id}_tc_type_diff_new" name="output_type"
                 type="radio" value="diff" class="toggle_tc_expected" checked="checked"
                 data-testable="${testable.id}" data-tc="new"/>
          <label for="testable_${testable.id}_tc_type_diff_new">Diff</label>
          <br/>
          <input id="testable_${testable.id}_tc_type_text_new" name="output_type"
                 type="radio" value="text"  class="toggle_tc_expected"
                 data-testable="${testable.id}" data-tc="new" />
          <label for="testable_${testable.id}_tc_type_text_new">Save (text)</label>
          <br/>
          <input id="testable_${testable.id}_tc_type_image_new" name="output_type"
                 type="radio" value="image"  class="toggle_tc_expected"
                 data-testable="${testable.id}" data-tc="new" />
          <label for="testable_${testable.id}_tc_type_image_new">Save (image)</label>
        </div>
        <fieldset id="testable_${testable.id}_new_expected_div">
          <legend>Diff settings</legend>
          <label for="testable_${testable.id}_tc_expected_new">Select the expected output file: </label>
          <input name="expected_id" id="testable_${testable.id}_tc_expected_new" type="file" />
          <br/>
          <input id="testable_${testable.id}_tc_expected_id_new" type="hidden"
                 name="expected_id" value="" />
          <input type="checkbox" name="hide_expected" id="testable_${testable.id}_tc_hide_expected_new" value="1"/>
          <label for="testable_${testable.id}_tc_hide_expected_new"><span class="help" title="This obscures the left-hand-side of the diff output in the student view thus preventing students from determining what their program should output.">Hide expected output</span></label>
        </fieldset>
        <input type="hidden" name="testable_id" value="${testable.id}" />
        <br/>
        <input type="submit" name="submit" value="add" />
      </form>
    </div>
  </div>


</div>
</div>
