<div metal:use-macro="_LAYOUT">
<div metal:fill-slot="content">
  <div tal:condition="prev_next">
    <hr>
    <div tal:replace="structure prev_next"></div>
    <hr>
  </div>

  <p>Submitted ${_pd(submission.created_at)}</p>

  <p tal:condition="not submission.verified_at">
    The submission is still being verified.
  </p>

  <p tal:condition="not submission.verified_at or (not submission.made_at and not submission.had_verification_errors())">
    The submission is still undergoing processing.  Please wait.
  </p>

  <div tal:condition="submission.verified_at and (submission.made_at or submission.had_verification_errors())">
    <pre tal:condition="submission.make_results">${submission.make_results}</pre>
    <p tal:condition="submission.had_build_errors()"
       style="color:red">
      Your submission had build errors that prevented tests from being run.
      You may want to consult <a href="http://discover.cs.ucsb.edu/commonerrors/errors.html" target="_blank">this page</a> for help.
    </p>

    <div tal:condition="file_warnings">
      <h3 style="color:yellow">Files with warnings:</h3>
      <ul>
	<div tal:repeat="file sorted(file_warnings.keys())">
	  <li tal:condition="len(file_warnings[file]) == 1">
	    <b>${file}</b>: ${file_warnings[file][0]}
	  </li>
	  <div tal:condition="len(file_warnings[file]) > 1">
	    <li>
	      <b>${file}</b>
	      <ul>
		<li tal:repeat="warning file_warnings[file]">
		  ${warning}
		</li>
	      </ul>
	    </li>
	  </div>
	</div>
      </ul>
    </div>
    
    <div tal:condition="file_errors">
      <h3 style="color:red">Files with errors:</h3>
      <ul>
	<div tal:repeat="file sorted(file_errors.keys())">
	  <li tal:condition="len(file_errors[file]) == 1">
	    <b>${file}</b>: ${file_errors[file][0]}
	  </li>
	  <div tal:condition="len(file_errors[file]) > 1">
	    <li>
	      <b>${file}</b>
	      <ul>
		<li tal:repeat="error file_errors[file]">
		  ${error}
		</li>
	      </ul>
	    </li>
	  </div>
	</div>
      </ul>
    </div>

    <div tal:condition="failed_from_bad_files">
      <div tal:repeat="bad_files sorted(failed_from_bad_files.keys(), key=lambda s: sorted(list(s)))">
	<div tal:replace="structure make_header(bad_files, failed_from_bad_files[bad_files])"></div>
	<ul>
	  <li tal:repeat="test sorted(failed_from_bad_files[bad_files])">
	    <b>${test.name}</b>: ${_fp(test.points)}
	  </li>
	</ul>
      </div>
    </div>

    <div tal:replace="structure diff_table"></div>

    <a tal:condition="request.user.is_admin_for_submission(submission)"
       href="${_R('zipfile_download', submission_id=submission.id)}">
      Download submission zipfile
    </a>
  </div>
</div>
</div>
