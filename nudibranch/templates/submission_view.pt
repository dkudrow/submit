<div metal:use-macro="_LAYOUT">
<div metal:fill-slot="content">
  <div tal:condition="prev_next">
    <hr>
    <div tal:replace="structure prev_next"></div>
    <hr>
  </div>

  <p>Submitted ${_pd(submission.created_at)}</p>
  <div tal:condition="submission.verified_at">
    <p>Submission verified ${_pd(submission.verified_at)}</p>
  </div>

  <div tal:condition="submission.made_at">
    <p>Submission made ${_pd(submission.made_at)}</p>
    <pre>${submission.make_results}</pre>
  </div>

  <div tal:condition="file_warnings">
    <h3 style="color:yellow">Files with warnings:</h3>
    <ul>
      <div tal:repeat="file sorted(file_warnings.keys())">
	<li tal:condition="len(file_warnings[file]) == 1">
	  <b>${file}</b>: ${file_warnings[file][0]}
	</li>
	<div tal:condition="len(file_warnings[file]) > 1">
	  <li>
	    <b>${file}</b>
	    <ul>
	      <li tal:repeat="warning file_warnings[file]">
		${warning}
	      </li>
	    </ul>
	  </li>
	</div>
      </div>
    </ul>
  </div>
      
  <div tal:condition="file_errors">
    <h3 style="color:red">Files with errors:</h3>
    <ul>
      <div tal:repeat="file sorted(file_errors.keys())">
	<li tal:condition="len(file_errors[file]) == 1">
	  <b>${file}</b>: ${file_errors[file][0]}
	</li>
	<div tal:condition="len(file_errors[file]) > 1">
	  <li>
	    <b>${file}</b>
	    <ul>
	      <li tal:repeat="error file_errors[file]">
		${error}
	      </li>
	    </ul>
	  </li>
	</div>
      </div>
    </ul>
  </div>

  <div tal:condition="failed_from_bad_files">
    <div tal:repeat="bad_files sorted(failed_from_bad_files.keys(), key=lambda s: sorted(list(s)))">
      <h3 style="color:red">Failed tests due to problems with these files: '<code>${", ".join(sorted(list(bad_files)))}</code>' ${_ap(_ss(failed_from_bad_files[bad_files]))}</h3>
      <ul>
	<li tal:repeat="test sorted(failed_from_bad_files[bad_files])">
	  ${test.name} ${_ap(test.points)}
	</li>
      </ul>
    </div>
  </div>

  <div tal:replace="structure diff_table"></div>

  <a tal:condition="request.user.is_admin_for_submission(submission)"
     href="${_R('zipfile_download', submission_id=submission.id)}">
    Download submission zipfile
  </a>
     
</div>
</div>
