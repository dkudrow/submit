<div metal:use-macro="_LAYOUT">
<div metal:fill-slot="content">
  <div class="header">Group management for ${project.name}</div>
  <div metal:use-macro="_MACROS['js_test']"></div>

  <fieldset tal:condition="flash">
    <legend>Status Messages</legend>
    <p tal:repeat="msg flash">${msg}</p>
  </fieldset>

  <div>
    Project: <a href="${_R('project_item_detailed_user', class_name=project.class_.name, project_id=project.id, username=request.user.username)}">${project.name}</a>
  </div>
  <div>Max Group Members: ${project.group_max}</div>
  <div>Members: ${members}</div>

  <div tal:condition="can_join and not requested">
    <h3>Make a request</h3>
    <p>Enter the email of someone in your class to request making a group with
    them. They will have to accept the group request.</p>
    <form name="input" action="${_R('project_group', project_id=project.id)}"
          method="POST" onsubmit="return form_request(this, 'put', true);">
      <p>
        <label for="email">Email</label>
        <input type="text" name="email" id="email"/>
        <input type="submit" name="submit" value="Submit"/>
      </p>
    </form>
  </div>
  <div tal:condition="not can_join">
    <p>You cannot add any more members to your group for this project.</p>
  </div>

  <div tal:condition="requested">
    <h3>Your existing requests</h3>
    <form name="input" action="${_R('project_group_item', project_id=project.id, group_request_id=requested.id)}"
          method="DELETE" onsubmit="return form_request(this, 'delete', true);"
          style="display: inline;">
      <input type="submit" name="submit" value="Revoke request"/>
    </form>
    ${requested.to_user}
    <p>Before you can make another request, the above request must be resolved.</p>
  </div>

  <div tal:condition="pending">
    <h3>Pending Requests from your fellow classmates</h3>
    <ul>
      <li tal:repeat="gr sorted(pending)">
        <form name="input" action="${_R('project_group_item', project_id=project.id, group_request_id=gr.id)}"
              method="DELETE" onsubmit="return form_request(this, 'delete', true);"
              style="display: inline;">
          <input type="submit" name="submit" value="Deny"/>
        </form>
        <form name="input" action="${_R('project_group_item', project_id=project.id, group_request_id=gr.id)}"
              method="PUT" onsubmit="return form_request(this, 'put', true);"
              style="display: inline;">
          <input type="submit" name="submit" value="Accept"/>
        </form>
        ${gr.from_user}
      </li>
    </ul>
  </div>
</div>
</div>
